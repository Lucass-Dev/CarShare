<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Stripe Elements - Diagnostic</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2b4d9a;
            margin-bottom: 10px;
        }
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        .test-cards {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #9c27b0;
        }
        .form-group {
            margin: 20px 0;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .stripe-element {
            background-color: white;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .stripe-element:hover {
            border-color: #4CAF50;
        }
        .stripe-element.StripeElement--focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        .stripe-element.StripeElement--invalid {
            border-color: #f44336;
        }
        .stripe-element.StripeElement--complete {
            border-color: #4CAF50;
        }
        #card-errors {
            color: #f44336;
            margin-top: 8px;
            font-size: 14px;
            min-height: 20px;
            font-weight: 500;
        }
        .success {
            color: #4CAF50;
        }
        .log-container {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-error {
            color: #ff5252;
        }
        .log-success {
            color: #69f0ae;
        }
        .log-info {
            color: #80deea;
        }
        button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-empty { background: #ffeb3b; color: #333; }
        .status-incomplete { background: #ff9800; color: white; }
        .status-complete { background: #4CAF50; color: white; }
        .status-error { background: #f44336; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Stripe Elements</h1>
        <p>Diagnostic du formulaire de carte bancaire</p>

        <div class="info-box">
            <h3>‚ÑπÔ∏è Instructions</h3>
            <ol>
                <li>Remplacez <code>VOTRE_CLE_PUBLIQUE</code> ci-dessous par votre vraie cl√© <strong>pk_test_...</strong></li>
                <li>Entrez le num√©ro de carte de test dans le champ</li>
                <li>Observez les messages d'erreur et les logs en temps r√©el</li>
            </ol>
        </div>

        <div class="test-cards">
            <h3>üìã Cartes de test Stripe</h3>
            <p>‚úÖ <strong>Carte valide :</strong> <code>4242424242424242</code> ou <code>4242 4242 4242 4242</code></p>
            <p>‚ùå <strong>Carte refus√©e :</strong> <code>4000000000000002</code></p>
            <p>üí° <strong>CVV :</strong> N'importe quel 3 chiffres (ex: 123)</p>
            <p>üìÖ <strong>Date :</strong> N'importe quelle date future (ex: 12/28)</p>
        </div>

        <form id="test-form">
            <div class="form-group">
                <label for="cardholder-name">
                    üë§ Nom du titulaire
                </label>
                <input type="text" id="cardholder-name" placeholder="Marie Dupont" value="Test User">
            </div>

            <div class="form-group">
                <label for="card-element">
                    üí≥ Informations de carte
                    <span id="card-status" class="status-badge status-empty">Vide</span>
                </label>
                <div id="card-element" class="stripe-element"></div>
                <div id="card-errors" role="alert"></div>
            </div>

            <button type="submit" id="submit-button">
                üîç Tester la validation
            </button>
        </form>

        <div class="log-container" id="log-container">
            <div class="log-entry log-info">üìä Logs en temps r√©el...</div>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è REMPLACEZ PAR VOTRE VRAIE CL√â PUBLIQUE pk_test_...
        const STRIPE_PUBLIC_KEY = 'pk_test_51SqcqKKkNIU0XghS3UZgDz8Wmzub0b6hoO6HjFPaASHwmIZvGmlmooB6VVLcreTalQ0vyrTu1K8UeNUZKGiS1w7r002HQeyKk5';
        
        const logContainer = document.getElementById('log-container');
        const cardStatusBadge = document.getElementById('card-status');
        
        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry log-' + type;
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        log('üîß Initialisation de Stripe...', 'info');
        
        try {
            const stripe = Stripe(STRIPE_PUBLIC_KEY);
            log('‚úÖ Stripe initialis√© avec succ√®s', 'success');
            log('üîë Cl√© publique : ' + STRIPE_PUBLIC_KEY.substring(0, 20) + '...', 'info');
            
            const elements = stripe.elements();
            log('‚úÖ Stripe Elements cr√©√©', 'success');
            
            const style = {
                base: {
                    color: '#2b4d9a',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                    fontSmoothing: 'antialiased',
                    fontSize: '16px',
                    '::placeholder': {
                        color: '#aab7c4'
                    }
                },
                invalid: {
                    color: '#f44336',
                    iconColor: '#f44336'
                }
            };
            
            const cardElement = elements.create('card', {
                style: style,
                hidePostalCode: true
            });
            
            log('‚úÖ Card Element cr√©√©', 'success');
            
            cardElement.mount('#card-element');
            log('‚úÖ Card Element mont√© sur #card-element', 'success');
            
            // √âcouter les changements
            cardElement.on('change', function(event) {
                const displayError = document.getElementById('card-errors');
                
                log('üìù √âv√©nement change d√©tect√©', 'info');
                log('   ‚Üí empty: ' + event.empty, 'info');
                log('   ‚Üí complete: ' + event.complete, 'info');
                log('   ‚Üí error: ' + (event.error ? event.error.code : 'aucune'), 'info');
                log('   ‚Üí brand: ' + (event.brand || 'inconnue'), 'info');
                
                // Mettre √† jour le badge de statut
                if (event.error) {
                    cardStatusBadge.className = 'status-badge status-error';
                    cardStatusBadge.textContent = 'Erreur';
                    displayError.textContent = '‚ùå ' + event.error.message;
                    log('‚ùå Erreur: ' + event.error.code + ' - ' + event.error.message, 'error');
                } else if (event.complete) {
                    cardStatusBadge.className = 'status-badge status-complete';
                    cardStatusBadge.textContent = 'Valide ‚úì';
                    displayError.textContent = '‚úÖ Carte valide et pr√™te';
                    displayError.className = 'success';
                    log('‚úÖ Carte compl√®te et valide !', 'success');
                } else if (event.empty) {
                    cardStatusBadge.className = 'status-badge status-empty';
                    cardStatusBadge.textContent = 'Vide';
                    displayError.textContent = '';
                    log('‚ö™ Champ vide', 'info');
                } else {
                    cardStatusBadge.className = 'status-badge status-incomplete';
                    cardStatusBadge.textContent = 'En cours...';
                    displayError.textContent = '';
                    log('‚è≥ Saisie en cours (incomplet)', 'info');
                }
            });
            
            cardElement.on('ready', function() {
                log('‚úÖ Card Element pr√™t √† recevoir des entr√©es', 'success');
            });
            
            cardElement.on('focus', function() {
                log('üéØ Focus sur le champ carte', 'info');
            });
            
            cardElement.on('blur', function() {
                log('üëã Perte du focus sur le champ carte', 'info');
            });
            
            // Gestion du formulaire
            const form = document.getElementById('test-form');
            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                log('üöÄ Soumission du formulaire...', 'info');
                
                const cardholderName = document.getElementById('cardholder-name').value;
                log('üë§ Nom du titulaire: ' + cardholderName, 'info');
                
                // Cr√©er un PaymentMethod pour tester (n√©cessite un SetupIntent en prod)
                try {
                    log('üîê Cr√©ation d\'un PaymentMethod de test...', 'info');
                    
                    const {paymentMethod, error} = await stripe.createPaymentMethod({
                        type: 'card',
                        card: cardElement,
                        billing_details: {
                            name: cardholderName
                        }
                    });
                    
                    if (error) {
                        log('‚ùå Erreur lors de la cr√©ation du PaymentMethod:', 'error');
                        log('   Code: ' + error.code, 'error');
                        log('   Message: ' + error.message, 'error');
                        alert('‚ùå Erreur: ' + error.message);
                    } else {
                        log('‚úÖ PaymentMethod cr√©√© avec succ√®s !', 'success');
                        log('   ID: ' + paymentMethod.id, 'success');
                        log('   Type: ' + paymentMethod.type, 'info');
                        log('   Brand: ' + paymentMethod.card.brand, 'info');
                        log('   Last4: ' + paymentMethod.card.last4, 'info');
                        log('   Exp: ' + paymentMethod.card.exp_month + '/' + paymentMethod.card.exp_year, 'info');
                        alert('‚úÖ Validation r√©ussie !\n\nPaymentMethod ID: ' + paymentMethod.id + '\nCarte: ' + paymentMethod.card.brand + ' **** ' + paymentMethod.card.last4);
                    }
                } catch (err) {
                    log('‚ùå Exception JavaScript:', 'error');
                    log('   ' + err.toString(), 'error');
                    console.error(err);
                    alert('‚ùå Erreur: ' + err.toString());
                }
            });
            
        } catch (error) {
            log('‚ùå ERREUR CRITIQUE lors de l\'initialisation:', 'error');
            log('   ' + error.toString(), 'error');
            alert('‚ùå Erreur critique: ' + error.message + '\n\nV√©rifiez que la cl√© publique est correcte !');
        }
    </script>
</body>
</html>
